name: CI\n\non:\n  push:\n  pull_request:\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    services:\n      postgres:\n        image: postgres:16\n        env:\n          POSTGRES_USER: postgres\n          POSTGRES_PASSWORD: postgres\n          POSTGRES_DB: pft_db\n        ports: ['5432:5432']\n        options: >-\n          --health-cmd=\"pg_isready -U postgres -d pft_db\"\n          --health-interval=5s\n          --health-timeout=5s\n          --health-retries=10\n\n    env:\n      POSTGRES_DB: pft_db\n      POSTGRES_USER: postgres\n      POSTGRES_PASSWORD: postgres\n      POSTGRES_HOST: localhost\n      POSTGRES_PORT: 5432\n      SECRET_KEY: ci-secret\n      DEBUG: 'False'\n      ALLOWED_HOSTS: 'localhost,127.0.0.1'\n      BASE_CURRENCY: USD\n\n    steps:\n      - uses: actions/checkout@v4\n      - name: Set up Python\n        uses: actions/setup-python@v5\n        with:\n          python-version: '3.12'\n      - name: Install backend deps\n        working-directory: backend\n        run: |\n          python -m pip install --upgrade pip\n          pip install -r requirements.txt\n      - name: Migrate\n        working-directory: backend\n        run: |\n          python manage.py migrate --noinput\n      - name: Run tests\n        run: |\n          pytest -q\n